# TDS核心概念

本文档为物联网应用中的**核心概念与顶层业务抽象**，了解这些概念，可以帮助您更好的使用TDS软件

## 监控

在一个典型的监控业务场景中，整个监控业务可以抽象地划分为“业务系统”和“监控系统”两个部分。如下图：
![iot_system_abstraction.svg](/img/iot_system_abstraction.svg)  

## 业务系统

### 对象

> 监控的目标对象称为**监控对象**，多个监控对象组成了业务系统

例如在一个厂区内，对10个炉头进行了监控。每一个“炉头”是一个监控对象

#### 对象树(objTree)

在实际的监控业务当中，监控对象往往会组织成一个树形结构。例如，某个工厂有2个车间，每个车间有2台锅炉，每台锅炉有2个炉头。如下图：
![.svg](/img/sample_iot_sys.svg)  
那么，在软件中可以用如下**监控对象树**来表示该业务系统:

![](/img/mo_tree.png)

对象树自上而下包含**三个层次**:

- 组织结构层

- 监控对象层

- 监控点层

#### 对象类型

![](/core/objTree.svg)

| 类型      | 说明                                                                            |
| ------- | ----------------------------------------------------------------------------- |
| 对象      | 一切被监控的目标都被视作**对象**，所有类型的基类                                                    |
| 组织结构    | 一般表示管理上的、空间上的一个节点，例如: XX集团，城北厂区，城南厂区。某个用户可以隶属于一个组织结构节点                        |
| 自定义组织结构 | 用户可以为某种固定的组织结构取一个名称，方便管理。例如一个幢楼共20层，可以定义一个**楼层**类型组织结构，共20个楼层，从而对20个楼层进行模板化管理 |
| 项目      | 监控统一管理的最小单元。一般代表一个独立的TDS服务                                                    |
| 监控点     | 监控点看做是一种特别的监控对象，它是最小的监控单元，等同于1个IO点的数据                                         |
| 监控点组    | 监测点组的数据，被认为是同时采样的，在历史数据中，同一个时间点，会保留监控点组中每一个监控点的数据                             |
| 自定义监控对象 | 用户可以为某种固定的组织结构取一个名称，方便管理。例如可以定义一个**风管机**类型监控对象，从而对多个风管机进行模板化管理                |

### 监控点

> 实际可以进行数据采集或者控制的监控对象的最小单元，称作**监控点**

例如，炉头的“火焰状态”是一个监控点，炉头的“气阀开闭”也是一个监控点

二楼温度，三楼湿度都是监控点

#### 对象属性

监控点可以看作是对象的属性。



会发生运动的监测点称作活动监测点，例如汽车、行人。
活动监测点往往关注何时进入某个区域，何时离开某个区域，在某个区域的停留时间。

### 位号(tag)

> 位号是业务系统中监测对象或监测点的唯一标识

例如1号车间的1号锅炉的1号炉头的火焰状态，在软件中表示为:

> 1号车间.1号锅炉.1号炉头.火焰状态

将目标监测点的各个父节点的名称，通过符号“.”连接的字符串，称作“位号”

#### 位号表示法

用户属于不同的组织结构，因此用户看到的位号不是在整个系统中的位号。而是相对于他所属的组织结构的位号。

例如有一个监控系统，总的系统名称为"大楼温湿度监控" ，子MO为"一楼", "二楼"，一楼二楼都监控了各自的温湿度，并且大楼管理员可以看到整幢楼所有的温湿度，一楼管理员只能看到一楼，二楼管理员只能看到二楼。

| 位号名称          | 例子                |
| ------------- | ----------------- |
| 系统位号   sysTag | 杭州.科技大楼.一楼.开水间.温度 |
| 用户组织  org     | 杭州.科技大楼           |
| 用户位号 userTag  | 一楼.开水间.温度         |
| 根位号 rootTag   | 一楼                |
| 位号 tag        | 开水间.温度            |

#### 用户位号和系统位号

![](/core/sysTagAndUserTag.svg)

#### 根位号

![](/core/rootTag.svg)

## 监控系统

![](/img/monitor_system.svg)  

在应用中，监控系统被抽象如下几个模块:

| 模块名称 | 模块功能                                    |
| ---- | --------------------------------------- |
| IO设备 | 安装在监控对象上，对监控对象进行数据采集或者进行控制的硬件设备，统称为IO设备 |
| IO服务 | 对IO设备进行数据采集或者下发控制指令的软件                  |
| IO网关 | 用于连接IO设备和IO服务，使得系统可以连接不同的总线上的IO设备       |
| 数据服务 | 监控系统的统一对外服务接口。TDS软件即为数据服务。              |

### 设备

设备指用于监控某个对象的硬件设备，一般一个设备下面会有多个通道，接入了多个传感器或者控制执行机构

#### 智能设备

当某一个监控对象的监控对象和IO设备合为一体时，该对象可以看作1个智能设备。

新一代的物联网智能产品，都可以理解为 对象与设备的一体化

例如一个带智能通信的空调

### 通道

一路温度，湿度，或者一个开关，都认为是一个通道

### 地址

#### 设备地址

设备地址取决于设备的通信方式，例如can设备的设备地址就是CanID, 以太网设备的地址就是IP+端口，ModbusRTU设备的设备地址就是RS485地址

#### IO地址

**IO地址**是监控设备在通信层面上的唯一地址。

根据数据在监控系统当中的通信链路，链路上的每一个设备的设备地址组合成IO地址
例如以上示例当中，气阀控制设备的RS485地址为1,Modbus网关的ip地址为192.168.2.100,那么认为该气阀控制设备的IO地址为:
192.168.2.100/1

假设该设备上接了一个气压传感器，传感器通道为2，那么该传感器通道的IO地址为:

192.168.2.100/1/2

通过IO地址,可以定位系统当中的任意一个监控设备或者通道

## 数据连接

数据连接将业务系统与监控系统进行关联

### 数据与设备解耦

当用户需要对业务系统进行功能组态时，本质是对位号进行组态。  
位号体现的是业务功能，是面向用户的。和系统内部具体的通信结构，使用什么型号的硬件设备无关。 
**例如**

> 用户需要设置**机房1.机柜2.温度**的**报警限为30℃**   
> 温度传感器在Modbus网关下，网关地址192.168.0.100，Modbus地址是1   
> 更换了温度传感器，新的温度传感器地址网关192.168.0.110，Modbus地址是2   
> 此时在系统中不是对新的IO地址 192.168.0.110/2 进行报警配置   
> 而是将新的IO地址通过**数据链接**链接到位号“机房1.机柜2.温度”   
> 配置后，报警配置将被应用到新的温度传感器。   

分离设计主要是为了隔离IO组态变化对业务组态配置的影响。在硬件设备尚未在现场安装时，即可预先完成所有业务功能逻辑配置。现场安装后，只需进行数据链接配置。

### 数据连接(绑点)

当系统采集到数据时，数据的唯一标识是采集设备的**IO地址**，例如：

> 温度采集来源于 温度传感器地址 网关192.168.0.110，Modbus地址是2   

但是用户在应用时，关心的是该温度监控的是哪个地方的温度，也就是**位号**，例如：

> 机房1.机柜2.温度 

软件中进行**数据链接**配置，将从IO服务过来的通过**IO地址**标识的数据（例如:192.168.0.110/2）**映射**为系统应用的中的业务标识，也就是位号**Tag**（例如:机房1.机柜2.温度）

## 
